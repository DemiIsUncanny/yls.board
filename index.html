<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Language Studio</title>
    <link rel="icon" type="image/jpg" href="logo.png">
    
    <style>
        :root {
            /* Paleta de Cores dos Jogadores */
            --p1-color: #ff4757; /* Red */
            --p2-color: #2ed573; /* Green */
            --p3-color: #1e90ff; /* Blue */
            --p4-color: #ffa502; /* Orange */
            --p5-color: #a55eea; /* Purple */
            --p6-color: #00d2d3; /* Cyan */

            --board-bg: #f0f2f5;
            --space-bg: #ffffff;
            --special-bg: #ffa502;
            --trade-bg: #747d8c;
            --menu-bg: #2f3542;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #dfe4ea;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* --- TELA DE MENU --- */
        #menu-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            padding: 20px;
        }

        /* Estilo da Logo Principal */
        .main-logo {
            max-width: 80%;
            height: auto;
            width: 350px; /* Tamanho base ajust√°vel */
            margin-bottom: 10px;
            display: block;
        }

        p.subtitle { margin-top: 0; font-style: italic; color: #57606f; margin-bottom: 20px; text-align: center;}

        /* Container dos seletores e bot√µes extras do menu */
        .menu-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
            margin-bottom: 30px;
        }

        .player-selector-container {
            background: white; padding: 15px 30px; border-radius: 50px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            display: flex; align-items: center; gap: 15px; border: 2px solid #3742fa;
        }
        .player-selector-container label { font-weight: bold; color: #2f3542; font-size: 1.1em; }
        .player-selector-container select { padding: 5px 10px; font-size: 1.1em; border-radius: 10px; border: 1px solid #ccc; cursor: pointer; }

        .btn-instructions {
            background-color: #ffa502;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .btn-instructions:hover { transform: scale(1.05); background-color: #eccc68; }

        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; width: 100%; padding: 10px; }
        .menu-card {
            background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border: 2px solid transparent;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .menu-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.15); border-color: #3742fa; }
        .menu-card h3 { color: #2f3542; margin: 10px 0; font-size: 1.1em; }
        .menu-card p { color: #747d8c; font-size: 0.85em; }
        .menu-icon { font-size: 2.5em; margin-bottom: 10px; display: block; }

        /* --- TELA DE INSTRU√á√ïES --- */
        #instructions-view {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 800px;
            padding: 30px;
            background-color: white;
            margin-top: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        #instructions-view h2 { color: #3742fa; border-bottom: 2px solid #ffa502; padding-bottom: 10px; }
        #instructions-view h3 { color: #2f3542; margin-top: 20px; }
        #instructions-view p, #instructions-view li { color: #57606f; line-height: 1.6; font-size: 1.1em; }
        #instructions-view ul { text-align: left; padding-left: 20px; }
        .mission-box {
            background-color: #f1f2f6;
            padding: 15px;
            border-left: 5px solid #2ed573;
            border-radius: 5px;
            margin: 20px 0;
            font-style: italic;
        }


        /* --- LAYOUT DO JOGO --- */
        #game-view {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        /* 1. CABE√áALHO FIXO */
        .game-header {
            position: sticky; top: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 1000;
            padding: 10px; display: flex; flex-direction: column; align-items: center;
            border-bottom: 1px solid #ccc;
        }

        .header-top-row {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; max-width: 1200px; margin-bottom: 5px;
        }

        .back-btn {
            background: #747d8c; color: white; border: none; padding: 5px 12px;
            border-radius: 20px; cursor: pointer; font-size: 12px;
        }
        .back-btn:hover { background: #57606f; }

        .status-display { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; flex-grow: 1; margin: 0 10px; }

        .player-wrapper {
            padding: 5px 10px; border-radius: 10px; border: 2px solid transparent;
            transition: all 0.3s; display: flex; flex-direction: column; align-items: center;
            background-color: #f1f2f6; min-width: 80px;
        }

        .player-name-input {
            border: none; background: transparent; font-size: 1em; font-weight: bold;
            text-align: center; width: 90px; padding: 2px; border-bottom: 1px dashed #ccc; cursor: text;
        }
        .player-name-input:focus { outline: none; border-bottom: 2px solid #3742fa; }

        .p1-color { color: var(--p1-color); } .p2-color { color: var(--p2-color); }
        .p3-color { color: var(--p3-color); } .p4-color { color: var(--p4-color); }
        .p5-color { color: var(--p5-color); } .p6-color { color: var(--p6-color); }
        
        .active-turn { background-color: #fff; border-color: #3742fa; box-shadow: 0 0 10px rgba(55, 66, 250, 0.3); transform: scale(1.05); }

        #messageBox {
            width: 90%; max-width: 800px; background-color: #fff3cd; border: 2px solid #ffeeba;
            border-radius: 8px; padding: 10px 20px; color: #856404; text-align: center;
            font-size: 1.2em; line-height: 1.3; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* 2. CONTROLES FLUTUANTES (MINIMIZADOS) */
        .floating-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            border: 2px solid #3742fa;
            width: 80px;
        }

        /* Dado Menor */
        .dice-container { perspective: 1000px; }
        #visualDice {
            font-size: 35px;
            width: 60px;
            height: 60px;
            background-color: white; border: 2px solid #3742fa;
            border-radius: 12px; display: flex; justify-content: center; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); font-weight: bold; color: #3742fa;
            cursor: pointer; user-select: none; transition: transform 0.2s;
        }
        .shaking { animation: shake 0.5s infinite; background-color: #fffae6 !important; color: #ffa502 !important; border-color: #ffa502 !important; }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* Bot√µes Compactos */
        button.action-btn { 
            border: none; padding: 6px 10px; font-size: 13px; 
            border-radius: 15px; cursor: pointer; transition: transform 0.1s; 
            width: 100%; font-weight: bold; 
        }
        #rollBtn { 
            background-color: #3742fa; color: white; font-size: 14px; 
            box-shadow: 0 2px 4px rgba(55, 66, 250, 0.3); 
        }
        #resetBtn { 
            background-color: transparent; color: #95a5a6; 
            font-size: 10px; border: 1px solid #dfe6e9; padding: 4px;
            font-weight: normal;
        }
        #resetBtn:hover { background-color: #dfe6e9; color: #d63031; }
        
        button.action-btn:active { transform: scale(0.95); }
        button.action-btn:disabled { background-color: #ccc; cursor: not-allowed; }

        /* 3. TABULEIRO */
        .board {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
            gap: 15px; width: 95%; max-width: 1200px;
            margin-top: 20px; padding-bottom: 50px;
        }

        .space {
            background-color: var(--space-bg); border: 2px solid #ced6e0; border-radius: 10px;
            padding: 15px; min-height: 120px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            position: relative; font-size: 1.1em; font-weight: 500; transition: transform 0.2s;
        }
        .space:hover { transform: scale(1.02); box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 5; }
        .space.special { background-color: #ffeaa7; border-color: var(--special-bg); }
        .space.trade { background-color: #dfe4ea; border-color: var(--trade-bg); }
        .space.start { background-color: #a4b0be; color: white; }
        .space.finish { background-color: #ff6b81; color: white; font-weight: bold; }
        .number { position: absolute; top: 5px; left: 8px; font-size: 12px; color: #999; }

        /* Pe√µes */
        .token { width: 22px; height: 22px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); transition: all 0.5s ease; }
        .token-container { display: flex; gap: 4px; margin-top: 8px; flex-wrap: wrap; justify-content: center; }
        
        .p1-token { background-color: var(--p1-color); } .p2-token { background-color: var(--p2-color); }
        .p3-token { background-color: var(--p3-color); } .p4-token { background-color: var(--p4-color); }
        .p5-token { background-color: var(--p5-color); } .p6-token { background-color: var(--p6-color); }

        .instruction { font-weight: bold; color: #2f3542; margin-top: 5px; display: block; font-size: 1.1em; }

    </style>
</head>
<body>

    <div id="menu-view">
        <img src="logo.png" alt="Your Language Studio Logo" class="main-logo">
        <p class="subtitle">Escolha um tabuleiro para jogar:</p>
        
        <div class="menu-controls">
            <div class="player-selector-container">
                <label for="playerCount">üë• N√∫mero de Jogadores:</label>
                <select id="playerCount">
                    <option value="2">2 Jogadores</option>
                    <option value="3">3 Jogadores</option>
                    <option value="4">4 Jogadores</option>
                    <option value="5">5 Jogadores</option>
                    <option value="6">6 Jogadores</option>
                </select>
            </div>
            
            <button class="btn-instructions" onclick="showInstructions()">üìñ Como funciona & Objetivo</button>
        </div>

        <div class="menu-grid">
            <div class="menu-card" onclick="loadGame('favorites')">
                <span class="menu-icon">‚ù§Ô∏è</span> <h3>Favorites</h3> <p>Coisas favoritas.</p>
            </div>
            <div class="menu-card" onclick="loadGame('routine')">
                <span class="menu-icon">‚è∞</span> <h3>Daily Routine</h3> <p>Present Simple.</p>
            </div>
            <div class="menu-card" onclick="loadGame('verbs')">
                <span class="menu-icon">‚ö°</span> <h3>Irregular Verbs</h3> <p>Past Simple.</p>
            </div>
            <div class="menu-card" onclick="loadGame('pp_context')">
                <span class="menu-icon">üß©</span> <h3>Context Challenge</h3> <p>Present Perfect.</p>
            </div>
            <div class="menu-card" onclick="loadGame('conversation')">
                <span class="menu-icon">üí¨</span> <h3>Conversation Master</h3> <p>60 Casas.</p>
            </div>
        </div>
    </div>

    <div id="instructions-view">
        <button class="back-btn" onclick="hideInstructions()" style="align-self: flex-start;">‚¨Ö Voltar ao Menu</button>
        
        <h2>Bem-vindo ao Your Language Studio!</h2>
        
        <div class="mission-box">
            "Nosso objetivo √© transformar o aprendizado de ingl√™s em uma experi√™ncia leve, divertida e altamente interativa. Queremos que voc√™ pratique a fala, a gram√°tica e o vocabul√°rio de forma natural, competindo e cooperando com seus amigos!"
        </div>

        <h3>üìù Como Jogar</h3>
        <ul>
            <li><strong>Escolha seu Desafio:</strong> Selecione um dos tabuleiros tem√°ticos no menu (ex: Rotina, Verbos, Conversa√ß√£o).</li>
            <li><strong>Defina os Jogadores:</strong> Escolha quantos amigos v√£o jogar com voc√™ (de 2 a 6).</li>
            <li><strong>Role o Dado:</strong> Clique no dado ou no bot√£o "ROLAR" para avan√ßar no tabuleiro.</li>
            <li><strong>Cumpra a Miss√£o:</strong> Ao cair em uma casa, leia a instru√ß√£o na caixa amarela. Voc√™ deve completar a frase ou responder a pergunta em ingl√™s!</li>
            <li><strong>Casas Especiais:</strong>
                <ul>
                    <li>üöÄ <strong>Go Ahead / Go Back:</strong> Avance ou volte casas extras.</li>
                    <li>üîÑ <strong>Trade Places:</strong> Troque de lugar com outro jogador aleat√≥rio!</li>
                </ul>
            </li>
            <li><strong>Vit√≥ria:</strong> O primeiro a chegar na casa "FINISH" vence o jogo!</li>
        </ul>
        
        <p style="text-align: center; margin-top: 20px;"><strong>Ready? Let's play! üé≤</strong></p>
    </div>

    <div id="game-view">
        
        <div class="game-header">
            <div class="header-top-row">
                <button class="back-btn" onclick="backToMenu()">‚¨Ö Menu</button>
                <div class="status-display" id="players-area">
                    </div>
            </div>
            
            <div id="messageBox">Edite os nomes acima e clique no dado para come√ßar!</div>
        </div>

        <div class="floating-controls">
            <div class="dice-container">
                <div id="visualDice" onclick="playTurn()">üé≤</div>
            </div>
            <button id="rollBtn" class="action-btn" onclick="playTurn()">ROLAR</button>
            <button id="resetBtn" class="action-btn" onclick="resetGame()">Reiniciar</button>
        </div>

        <div class="board" id="gameBoard"></div>
    </div>

<script>
    // --- BANCO DE DADOS ---
    const boardDatabase = {
        favorites: {
            title: "Favorites!", subtitle: "Say your favorite. Use full sentences!", instruction: "My favorite [item] is...",
            spaces: [ { text: "START", type: "start" }, { text: "Color", type: "standard" }, { text: "Season", type: "standard" }, { text: "GO AHEAD 3", type: "move", val: 3 }, { text: "Actor", type: "standard" }, { text: "Candy", type: "standard" }, { text: "Singer", type: "standard" }, { text: "Day of the Week", type: "standard" }, { text: "Meat", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Vegetable", type: "standard" }, { text: "Fruit", type: "standard" }, { text: "Fast Food", type: "standard" }, { text: "GO AHEAD 2", type: "move", val: 2 }, { text: "TV Show", type: "standard" }, { text: "Book", type: "standard" }, { text: "Time of Day", type: "standard" }, { text: "Job", type: "standard" }, { text: "Hobbie", type: "standard" }, { text: "Class in School", type: "standard" }, { text: "Movie", type: "standard" }, { text: "Country", type: "standard" }, { text: "Theme Park", type: "standard" }, { text: "Dessert", type: "standard" }, { text: "GO BACK 3", type: "move", val: -3 }, { text: "Drink", type: "standard" }, { text: "Ice Cream Flavor", type: "standard" }, { text: "Food", type: "standard" }, { text: "Shoe Brand", type: "standard" }, { text: "GO BACK 2", type: "move", val: -2 }, { text: "City", type: "standard" }, { text: "Sport", type: "standard" }, { text: "Holiday", type: "standard" }, { text: "Game", type: "standard" }, { text: "Pet", type: "standard" }, { text: "Word", type: "standard" }, { text: "Music", type: "standard" }, { text: "Feeling", type: "standard" }, { text: "Animal", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Adjective", type: "standard" }, { text: "Name", type: "standard" }, { text: "FINISH", type: "finish" } ]
        },
        routine: {
            title: "Daily Routine", subtitle: "What do you do?", instruction: "I usually [action] at/in...",
            spaces: [ { text: "START", type: "start" }, { text: "Wake up", type: "standard" }, { text: "Eat breakfast", type: "standard" }, { text: "Brush teeth", type: "standard" }, { text: "GO AHEAD 2", type: "move", val: 2 }, { text: "Go to school/work", type: "standard" }, { text: "Take a shower", type: "standard" }, { text: "Get dressed", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Have lunch", type: "standard" }, { text: "Study", type: "standard" }, { text: "Play games", type: "standard" }, { text: "Watch TV", type: "standard" }, { text: "GO BACK 2", type: "move", val: -2 }, { text: "Cook dinner", type: "standard" }, { text: "Read a book", type: "standard" }, { text: "Clean the room", type: "standard" }, { text: "Go to bed", type: "standard" }, { text: "Exercise", type: "standard" }, { text: "Use the phone", type: "standard" }, { text: "Walk the dog", type: "standard" }, { text: "Wash dishes", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Relax", type: "standard" }, { text: "FINISH", type: "finish" } ]
        },
        verbs: {
            title: "Irregular Verbs", subtitle: "Say the Past Simple form!", instruction: "The past of [verb] is...",
            spaces: [ { text: "START", type: "start" }, { text: "Go", type: "standard" }, { text: "See", type: "standard" }, { text: "Eat", type: "standard" }, { text: "Drink", type: "standard" }, { text: "Run", type: "standard" }, { text: "GO AHEAD 3", type: "move", val: 3 }, { text: "Buy", type: "standard" }, { text: "Think", type: "standard" }, { text: "Sleep", type: "standard" }, { text: "Speak", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Write", type: "standard" }, { text: "Read", type: "standard" }, { text: "Swim", type: "standard" }, { text: "Drive", type: "standard" }, { text: "Make", type: "standard" }, { text: "GO BACK 2", type: "move", val: -2 }, { text: "Do", type: "standard" }, { text: "Have", type: "standard" }, { text: "Give", type: "standard" }, { text: "Take", type: "standard" }, { text: "Know", type: "standard" }, { text: "Sing", type: "standard" }, { text: "Fly", type: "standard" }, { text: "Come", type: "standard" }, { text: "Get", type: "standard" }, { text: "FINISH", type: "finish" } ]
        },
        pp_context: {
            title: "Context Challenge", subtitle: "Add a context (Present Perfect).", instruction: "I [have context], so [sentence].",
            spaces: [ { text: "START", type: "start" }, { text: "I missed the bus", type: "standard" }, { text: "She bought a car", type: "standard" }, { text: "They sold the house", type: "standard" }, { text: "GO AHEAD 2", type: "move", val: 2 }, { text: "I lost my wallet", type: "standard" }, { text: "He broke his leg", type: "standard" }, { text: "We ate pizza", type: "standard" }, { text: "She cried", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "The dog barked", type: "standard" }, { text: "I forgot the answer", type: "standard" }, { text: "They arrived late", type: "standard" }, { text: "GO AHEAD 3", type: "move", val: 3 }, { text: "He went to the doctor", type: "standard" }, { text: "I slept all day", type: "standard" }, { text: "We watched a movie", type: "standard" }, { text: "She quit her job", type: "standard" }, { text: "GO BACK 3", type: "move", val: -3 }, { text: "I drank water", type: "standard" }, { text: "They called the police", type: "standard" }, { text: "He failed the test", type: "standard" }, { text: "I took a shower", type: "standard" }, { text: "We cleaned the room", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "She wrote a letter", type: "standard" }, { text: "I visited my mom", type: "standard" }, { text: "He bought flowers", type: "standard" }, { text: "We ran away", type: "standard" }, { text: "GO BACK 2", type: "move", val: -2 }, { text: "I found 10 dollars", type: "standard" }, { text: "FINISH", type: "finish" } ]
        },
        conversation: {
            title: "Conversation Master", subtitle: "Talk for 1 minute!", instruction: "Let's talk about [topic]...",
            spaces: [ { text: "START", type: "start" }, { text: "Dream Job", type: "standard" }, { text: "Favorite Movie", type: "standard" }, { text: "GO AHEAD 2", type: "move", val: 2 }, { text: "Best Friend", type: "standard" }, { text: "Worst Habit", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Hobbies", type: "standard" }, { text: "Rainy Day", type: "standard" }, { text: "Biggest Fear", type: "standard" }, { text: "GO AHEAD 3", type: "move", val: 3 }, { text: "Favorite Season", type: "standard" }, { text: "Role Model", type: "standard" }, { text: "Social Media", type: "standard" }, { text: "GO BACK 2", type: "move", val: -2 }, { text: "Superpower", type: "standard" }, { text: "Aliens", type: "standard" }, { text: "Favorite Food", type: "standard" }, { text: "Money or Fame", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Best Vacation", type: "standard" }, { text: "Happiness", type: "standard" }, { text: "Shopping", type: "standard" }, { text: "GO AHEAD 4", type: "move", val: 4 }, { text: "Technology", type: "standard" }, { text: "Cooking", type: "standard" }, { text: "Future Plans", type: "standard" }, { text: "GO BACK 3", type: "move", val: -3 }, { text: "Favorite Animal", type: "standard" }, { text: "Childhood", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Sports", type: "standard" }, { text: "Music Taste", type: "standard" }, { text: "GO AHEAD 2", type: "move", val: 2 }, { text: "Book or Movie", type: "standard" }, { text: "Morning/Night", type: "standard" }, { text: "Stress Relief", type: "standard" }, { text: "GO BACK 2", type: "move", val: -2 }, { text: "Perfect Date", type: "standard" }, { text: "Lottery Win", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Climate Change", type: "standard" }, { text: "Learning English", type: "standard" }, { text: "GO AHEAD 2", type: "move", val: 2 }, { text: "Video Games", type: "standard" }, { text: "Holidays", type: "standard" }, { text: "GO BACK 3", type: "move", val: -3 }, { text: "Guilty Pleasure", type: "standard" }, { text: "Best Advice", type: "standard" }, { text: "TRADE PLACES", type: "trade" }, { text: "Hidden Talent", type: "standard" }, { text: "A Lie You Told", type: "standard" }, { text: "GO BACK 5", type: "move", val: -5 }, { text: "3 Wishes", type: "standard" }, { text: "Embarrassing Moment", type: "standard" }, { text: "Proud Moment", type: "standard" }, { text: "Phobias", type: "standard" }, { text: "Ideal House", type: "standard" }, { text: "FINISH", type: "finish" } ]
        }
    };

    // --- L√ìGICA DO JOGO ---
    let currentSpaces = [];
    let currentInstruction = "";
    let players = [];
    let currentPlayerIndex = 0;
    let isAnimating = false;
    const playerColors = ["p1-token", "p2-token", "p3-token", "p4-token", "p5-token", "p6-token"];
    const textColors = ["p1-color", "p2-color", "p3-color", "p4-color", "p5-color", "p6-color"];

    // Elementos DOM
    const menuView = document.getElementById("menu-view");
    const gameView = document.getElementById("game-view");
    const instructionsView = document.getElementById("instructions-view");
    const messageBox = document.getElementById("messageBox");
    const boardEl = document.getElementById("gameBoard");
    const rollBtn = document.getElementById("rollBtn");
    const visualDice = document.getElementById("visualDice");
    const playerCountSelect = document.getElementById("playerCount");
    const playersArea = document.getElementById("players-area");

    function loadGame(gameId) {
        const gameData = boardDatabase[gameId];
        currentSpaces = gameData.spaces;
        currentInstruction = gameData.instruction;

        const numPlayers = parseInt(playerCountSelect.value);
        setupPlayers(numPlayers);
        
        resetLogic();
        menuView.style.display = "none";
        instructionsView.style.display = "none";
        gameView.style.display = "flex";
        initBoard();
    }

    function showInstructions() {
        menuView.style.display = "none";
        gameView.style.display = "none";
        instructionsView.style.display = "flex";
    }

    function hideInstructions() {
        instructionsView.style.display = "none";
        menuView.style.display = "flex";
    }

    function setupPlayers(count) {
        players = [];
        playersArea.innerHTML = ""; 

        for (let i = 0; i < count; i++) {
            players.push({ name: `Jogador ${i + 1}`, pos: 0, cssClass: playerColors[i], id: i });

            const wrapper = document.createElement("div");
            wrapper.className = "player-wrapper";
            wrapper.id = `wrapper-${i}`;
            
            wrapper.innerHTML = `
                <input type="text" class="player-name-input ${textColors[i]}" value="Jogador ${i + 1}" maxlength="10" oninput="updateName(${i}, this.value)">
            `;
            playersArea.appendChild(wrapper);
        }
    }

    function backToMenu() {
        gameView.style.display = "none";
        instructionsView.style.display = "none";
        menuView.style.display = "flex";
    }

    function initBoard() {
        boardEl.innerHTML = "";
        currentSpaces.forEach((space, index) => {
            const div = document.createElement("div");
            div.className = "space";
            if (space.type === "move" || space.type === "trade") div.classList.add("special");
            if (space.type === "trade") div.classList.add("trade");
            if (space.type === "start") div.classList.add("start");
            if (space.type === "finish") div.classList.add("finish");
            div.id = `space-${index}`;

            div.innerHTML = `
                <div class="number">${index}</div>
                <div>${space.text}</div>
                <div class="token-container" id="tokens-${index}"></div>
            `;
            boardEl.appendChild(div);
        });
        updateTokens();
    }

    function updateName(playerIndex, newName) {
        if(newName.trim() === "") newName = `P${playerIndex + 1}`;
        players[playerIndex].name = newName;
        updateTokens(); 
    }

    function updateTokens() {
        document.querySelectorAll(".token-container").forEach(el => el.innerHTML = "");
        players.forEach(p => {
            const container = document.getElementById(`tokens-${p.pos}`);
            if (container) {
                const token = document.createElement("div");
                token.className = `token ${p.cssClass}`;
                token.title = p.name; 
                container.appendChild(token);
            }
        });
    }

    function resetGame() {
        if(!confirm("Reiniciar o jogo?")) return;
        resetLogic();
        updateTokens();
    }

    function resetLogic() {
        players.forEach(p => p.pos = 0);
        currentPlayerIndex = 0;
        isAnimating = false;
        rollBtn.disabled = false;
        visualDice.innerText = "üé≤";
        messageBox.style.backgroundColor = "#fff3cd";
        messageBox.style.color = "#856404";
        messageBox.innerHTML = "Clique no dado para come√ßar!";
        updateActiveTurnUI();
    }

    function updateActiveTurnUI() {
        players.forEach((p, index) => {
            const wrapper = document.getElementById(`wrapper-${index}`);
            if (index === currentPlayerIndex) {
                wrapper.classList.add("active-turn");
            } else {
                wrapper.classList.remove("active-turn");
            }
        });
    }

    function playTurn() {
        if (isAnimating) return;
        isAnimating = true;
        rollBtn.disabled = true;

        const player = players[currentPlayerIndex];
        messageBox.innerHTML = `üé≤ Rolando para <strong>${player.name}</strong>...`;
        
        visualDice.classList.add("shaking");
        
        let rollInterval = setInterval(() => {
            visualDice.innerText = Math.floor(Math.random() * 6) + 1;
        }, 80); 

        setTimeout(() => {
            clearInterval(rollInterval);
            visualDice.classList.remove("shaking");
            
            const dice = Math.floor(Math.random() * 6) + 1;
            visualDice.innerText = dice;
            messageBox.innerHTML = `üé≤ ${player.name} tirou <strong>${dice}</strong>!`;

            setTimeout(() => { processMove(player, dice); }, 500);
        }, 1000);
    }

    function processMove(player, dice) {
        let newPos = player.pos + dice;
        const lastIndex = currentSpaces.length - 1; 
        if (newPos >= lastIndex) {
            player.pos = lastIndex;
            updateTokens();
            finishGame(player);
        } else {
            movePlayer(player, newPos);
        }
    }

    function movePlayer(player, targetPos) {
        player.pos = targetPos;
        updateTokens();
        
        const space = currentSpaces[targetPos];

        if (space.type === "move") {
            messageBox.innerHTML += `<br>üöÄ Casa Especial! ${space.text}`;
            setTimeout(() => {
                let jumpPos = player.pos + space.val;
                if (jumpPos < 0) jumpPos = 0;
                movePlayer(player, jumpPos); 
            }, 1000);
            return; 
        } 
        else if (space.type === "trade") {
            const opponents = players.filter(p => p.id !== player.id);
            const target = opponents[Math.floor(Math.random() * opponents.length)];
            messageBox.innerHTML += `<br>üîÑ TROCA COM: <strong>${target.name}</strong>!`;
            
            setTimeout(() => {
                const tempPos = player.pos;
                player.pos = target.pos;
                target.pos = tempPos;
                updateTokens();
                const newSpace = currentSpaces[player.pos];
                endTurn(player, newSpace);
            }, 1500);
            return;
        }

        endTurn(player, space);
    }

    function endTurn(player, space) {
        if (space.type !== "start" && space.type !== "finish") {
            let instructionText = currentInstruction.replace("[item]", space.text.toLowerCase())
                                                    .replace("[action]", space.text.toLowerCase())
                                                    .replace("[verb]", space.text.toLowerCase())
                                                    .replace("[sentence]", space.text.toLowerCase())
                                                    .replace("[topic]", space.text.toLowerCase())
                                                    .replace("[have context]", "<span style='text-decoration: underline'>have + p.p.</span>");
            
            messageBox.innerHTML = `
                <strong>${player.name}</strong>: <span style="color:#d63031;">${space.text}</span><br>
                <span class="instruction">${instructionText}</span>
            `;
        }
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        updateActiveTurnUI();
        isAnimating = false;
        rollBtn.disabled = false;
    }

    function finishGame(winner) {
        winner.pos = currentSpaces.length - 1;
        updateTokens();
        messageBox.innerHTML = `üéâ <strong>${winner.name} VENCEU!</strong> üéâ`;
        messageBox.style.backgroundColor = "#d1e7dd";
        messageBox.style.color = "#0f5132";
        rollBtn.style.display = "none";
        visualDice.style.display = "none";
        isAnimating = false;
    }

</script>
</body>
</html>
